<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Ø¹Ú©Ø³ØªÙˆ Ú†Ø§Ù¾ Ú©Ù†</title>

  <link rel="icon" type="image/jpeg" href="./logo.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<style>
@font-face{
  font-family:"MyFont";
  src:url("font.woff2") format("woff2");
}

html,body{
  margin:0;
  padding:0;
  background:#c9c9c9;
  font-family:MyFont,sans-serif;
}

.wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.card{
  width:320px;
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 14px 38px rgba(0,0,0,.17);
  z-index:2;
}

/* ART */
.art{
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 10px 22px rgba(0,0,0,.14);
}
.art img{
  width:100%;
  display:block;
}

/* TEXT */
.caption{
  margin-top:10px;
  padding:6px 4px;
  font-size:14px;
  color:#555;
  text-align:center;
  min-height:22px;
}

/* CONTROLS */
.controls{
  margin-top:8px;
}

audio{
  width:100%;
  border-radius:8px;
}

.canvas-spectrum{
  width:100%;
  height:55px;
  margin-top:10px;
}

/* SNOW */
#snow{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1;
}
</style>

<body>

<canvas id="snow"></canvas>

<div class="wrapper">
  <div class="card">

    <div class="art">
      <img src="art.jpg">
    </div>

    <div class="caption">
      <span dir="rtl">
        Ù¾Ø¯Ø± ÛŒØ¹Ù†ÛŒ Ù‡Ø± Ú†Ù‡ Ø¨Ø§Ø´Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒØª Ø³Ø®ØªØŒ Ù…Ù† Ù‡Ø³ØªÙ… Ø®ÛŒØ§Ù„Øª ØªØ®Øª  
        <br>
        Ø¨Ø§Ø¨Ø§ÛŒÛŒ Ø±ÙˆØ²Øª Ù…Ø¨Ø§Ø±Ú© â¤ï¸
      </span>
    </div>

    <div class="controls">
      <audio id="audio" controls src="song.mp3"></audio>
      <canvas id="spectrum" class="canvas-spectrum"></canvas>
    </div>

  </div>
</div>

<script>
/* ===== AUDIO + WAVEFORM ===== */
const audio = document.getElementById("audio");
const canvas = document.getElementById("spectrum");
const ctx = canvas.getContext("2d");

let audioCtx, analyser, source, ready=false;

function initAudio(){
  if(ready) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  source = audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);
  ready = true;
}

/* ğŸ”‘ unlock audio on first user interaction */
document.addEventListener("click",()=>{
  if(!audioCtx){
    initAudio();
  }
  audioCtx.resume();
},{ once:true });

function resizeSpectrum(){
  const r = canvas.getBoundingClientRect();
  const dpr = devicePixelRatio || 1;
  canvas.width = r.width * dpr;
  canvas.height = r.height * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resizeSpectrum();
addEventListener("resize", resizeSpectrum);

const data = new Uint8Array(1024);

(function draw(){
  requestAnimationFrame(draw);
  if(!ready) return;

  analyser.getByteTimeDomainData(data);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  const mid = h/2;

  ctx.fillStyle="rgba(255,255,255,.85)";
  ctx.shadowColor="rgba(0,0,0,.28)";
  ctx.shadowBlur=8;

  ctx.beginPath();
  ctx.moveTo(0,mid);
  for(let i=0;i<data.length;i++){
    const x = i/data.length*w;
    const v = (data[i]-128)/128;
    ctx.lineTo(x, mid + v*mid*0.85);
  }
  ctx.lineTo(w,mid);
  ctx.lineTo(w,h);
  ctx.lineTo(0,h);
  ctx.closePath();
  ctx.fill();

  ctx.shadowBlur=0;
})();

audio.addEventListener("play",()=>{
  initAudio();
  audioCtx.resume();
});

/* ===== SNOW ===== */
const snow = document.getElementById("snow");
const sc = snow.getContext("2d");

function resizeSnow(){
  const dpr = devicePixelRatio || 1;
  snow.width = innerWidth * dpr;
  snow.height = innerHeight * dpr;
  sc.setTransform(dpr,0,0,dpr,0,0);
}
resizeSnow();
addEventListener("resize", resizeSnow);

const flakes = Array.from({length:150},()=>{
  const r=Math.random()*2.6+.4;
  return{
    x:Math.random()*innerWidth,
    y:Math.random()*innerHeight,
    r,
    vy:.15+r*.35,
    drift:.2+r*.6,
    a:.4+Math.random()*.6,
    ph:Math.random()*6.28
  };
});

(function snowDraw(){
  requestAnimationFrame(snowDraw);
  sc.clearRect(0,0,snow.width,snow.height);
  flakes.forEach(f=>{
    f.ph+=.008;
    f.y+=f.vy;
    f.x+=Math.sin(f.ph)*f.drift;
    sc.globalAlpha=f.a;
    sc.fillStyle="#ededed";
    sc.beginPath();
    sc.arc(f.x,f.y,f.r,0,6.28);
    sc.fill();
    if(f.y>innerHeight){
      f.y=-10;
      f.x=Math.random()*innerWidth;
    }
  });
})();
</script>

</body>
</html>
